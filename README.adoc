image::docs/images/image_bakery.png[image_bakery,width="20%",height="20%",align="center"]

[.text-center]
= Image Bakery

---

[.float-group]
--
image::https://img.shields.io/badge/License-Apache%202.0-blue.svg"[Apache License, float="left"]
image::https://gitlab.com/gacybercenter/image-bakery/badges/master/pipeline.svg[Pipeline Status, float="left"]
image::https://img.shields.io/docker/cloud/build/gacybercenter/image-bakery[Docker Build, float="left"]
image::https://img.shields.io/docker/pulls/gacybercenter/image-bakery.svg[Docker Pulls, float="left"]
--

== Basic Overview

Image Bakery is a image creation utility focused on creating reproducible images of several types to include VM, cloud images, docker, and direct to metal. +

Image Bakery uses a combination of virt-builder, virt-customize, docker, minio, and other tools to achieve these goals. +

The format for defining an image build is still unstable and very much a work in progress, so the ugly direct-to-ci hack is just being used for testing purposes until cli interface is fleshed out. +

WARNING: The runner must expose `/dev/kvm` to the job for Image Bakery to work properly. Failure to do so will result in a painfully slow image building experience. This issue can be addressed by running the docker container in privileged mode and adding the runner job user to the kvm group.

.sample image.yaml
[source, yaml]
----
---

image_name: ubuntu-18.04

compressed: false

convert: true

output_format: raw

compression: xz

method: virt-builder

packages:
    - pkg1
    - pkg2

customization: |
    #!/bin/bash
    echo "customization completed via virt-builder" > ./custom.txt

----

.sample config.toml
[source, toml]
----
[[runners]]
  ...
  [runners.custom_build_dir]
  [runners.cache]
    [runners.cache.s3]
    [runners.cache.gcs]
  [runners.docker]
    tls_verify = false
    image = "debian:latest"
    privileged = false
    devices = ["/dev/kvm"]
    disable_entrypoint_overwrite = false
    oom_kill_disable = false
    disable_cache = false
    volumes = ["/cache"]
    shm_size = 0
----
